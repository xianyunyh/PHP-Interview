### 概述

网络协议通常分不同层次进行开发，每一层分别负责不同的通信功能。一个协议族，比如 TCP/IP，是一组不同层次上的多个协议的组合。TCP/IP 通常被认为是一个四层协议系统。

![](./images/01.png)	

每一层负责不同的功能：1. ** 链路层 **，有时也称作数据链路层或网络接口层，通常包括操作系统中的设备驱动程序和计算机中对应的网络接口卡。它们一起处理与电缆（或其他任何传输媒介）的物理接口细节。2. ** 网络层 **，有时也称作互联网层，处理分组在网络中的活动，例如分组的选路。在 TCP/IP 协议族中，网络层协议包括 IP 协议（网际协议），ICMP 协议（Internet 互联网控制报文协议），以及 IGMP 协议（Internet 组管理协议）。3. ** 运输层 ** 主要为两台主机上的应用程序提供端到端的通信。在 TCP/IP 协议族中，有两个互不相同的传输协议：TCP（传输控制协议）和 UDP（用户数据报协议）。TCP 为两台主机提供高可靠性的数据通信。它所做的工作包括把应用程序交给它的数据分成合适的小块交给下面的网络层，确认接收到的分组，设置发送最后确认分组的超时时钟等。由于运输层提供了高可靠性的端到端的通信，因此应用层可以忽略所有这些细节。而另一方面，UDP 则为应用层提供一种非常简单的服务。它只是把称作数据报的分组从一台主机发送到另一台主机，但并不保证该数据报能到达另一端。任何必需的可靠性必须由应用层来提供。这两种运输层协议分别在不同的应用程序中有不同的用途，这一点将在后面看到。4. ** 应用层 ** 负责处理特定的应用程序细节。几乎各种不同的 TCP/IP 实现都会提供下面这些通用的应用程序：• Telnet 远程登录。• FTP 文件传输协议。• SMTP 简单邮件传送协议。• SNMP 简单网络管理协议。![tcp](./images/02.png)



### 互联网地址

互联网上的每个接口必须有一个唯一的 Internet 地址（也称作 IP 地址）。IP 地址长 32 bit。Internet 地址并不采用平面形式的地址空间，如 1、2、3 等。IP 地址具有一定的结构，五类不同的互联网地址格式如图 1 - 5 所示。![](./images/04.png)

### 用户数据封装和分用

应用程序用 TCP 传送数据时，数据被送入协议栈中，然后逐个通过每一层直到被当作一串比特流送入网络。其中每一层对收到的数据都要增加一些首部信息（有时还要增加尾部信息），该过程如图 1 - 7 所示。TCP 传给 IP 的数据单元称作 TCP 报文段或简称为 TCP 段（TCP segment）。IP 传给网络接口层的数据单元称作 IP 数据报 (IP datagram)。通过以太网传输的比特流称作帧 (Frame)

![](./images/5.png)

当目的主机收到一个以太网数据帧时，数据就开始从协议栈中由底向上升，同时去掉各层协议加上的报文首部。每层协议盒都要去检查报文首部中的协议标识，以确定接收数据的上层协议。这个过程称作分用（Demultiplexing）！[](./images/6.png)

### 端口号

服务器一般通过端口号来识别对应的应用程序。TCP 和 UDP 采用 16 bit 的端口号来识别应用程序。任何 TCP/IP 实现所提供的服务都用知名的 1～1023 之间的端口号。大多数 TCP/IP 实现给临时端口分配 1024～5000 之间的端口号。大于 5000 的端口号是为其他服务器预留的（Internet 上并不常用的服务 )

> 到 1992 年为止，知名端口号介于 1～255 之间。256～1023 之间的端口号通常都是由 UNIX 系统占用，以提供一些特定的 UNIX 服务—也就是说，提供一些只有 UNIX 系统才有的、而其他操作系统可能不提供的服务。现在 IANA 管理 1～1023 之间所有的端口号。### 应用编程

TCP/Ip 协议的应用程序通常采用两种应用编程接口（Api）：socket 和 TLI（运输层接口：Transport Layer Interface）